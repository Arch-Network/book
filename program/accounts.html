<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Accounts - The Arch Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Documentation for the Arch Network - A Bitcoin-native computation environment">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item affix "><li class="part-title">Choose Your Path</li><li class="chapter-item "><a href="../getting-started/quick-start.html">üöÄ Quick Start Guide</a></li><li class="chapter-item "><a href="../getting-started/bitcoin-and-electrs-setup.html">üèóÔ∏è Run a Validator</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../getting-started/requirements.html">System Requirements</a></li><li class="chapter-item "><a href="../guides/how-to-configure-local-validator-bitcoin-testnet4.html">Network Selection</a></li><li class="chapter-item "><a href="../getting-started/validator-staking.html">Validator Staking</a></li></ol></li><li class="chapter-item "><li class="part-title">Program Development</li><li class="chapter-item "><a href="../guides/understanding-arch-programs.html">Understanding Arch Programs</a></li><li class="chapter-item "><a href="../guides/writing-your-first-program.html">Writing Your First Program</a></li><li class="chapter-item "><a href="../guides/guides.html">Program Examples</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../guides/how-to-create-a-fungible-token.html">Fungible Token</a></li><li class="chapter-item "><a href="../guides/how-to-write-oracle-program.html">Oracle Program</a></li><li class="chapter-item "><a href="../guides/how-to-build-runes-swap.html">Runes Swap</a></li><li class="chapter-item "><a href="../guides/how-to-build-lending-protocol.html">Lending Protocol</a></li></ol></li><li class="chapter-item "><li class="part-title">Core Concepts</li><li class="chapter-item "><a href="../concepts/architecture.html">Architecture Overview</a></li><li class="chapter-item "><a href="../concepts/network-architecture.html">Network Architecture</a></li><li class="chapter-item "><a href="../concepts/bitcoin-integration.html">Bitcoin Integration</a></li><li class="chapter-item expanded "><a href="../program/program.html">Programs</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../program/utxo.html">UTXOs</a></li><li class="chapter-item expanded "><a href="../program/accounts.html" class="active">Accounts</a></li><li class="chapter-item "><a href="../program/instructions-and-messages.html">Instructions</a></li><li class="chapter-item "><a href="../program/syscall.html">System Calls</a></li></ol></li><li class="chapter-item "><a href="../concepts/nodes.html">Node Operation</a></li><li class="chapter-item affix "><li class="part-title">Reference</li><li class="chapter-item "><a href="../rpc/rpc.html">API Reference</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rpc/http-methods.html">HTTP Methods</a></li><li class="chapter-item "><a href="../sdk/processed-transaction.html">Transaction Processing</a></li></ol></li><li class="chapter-item "><a href="../system-program/system-program.html">System Program</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../system-program/create-account.html">Account Creation</a></li><li class="chapter-item "><a href="../system-program/make-executable.html">Program Deployment</a></li></ol></li><li class="chapter-item "><li class="part-title">Resources</li><li class="chapter-item "><a href="../getting-started/troubleshooting.html">Troubleshooting</a></li><li class="chapter-item "><a href="../getting-started/faq.html">FAQ</a></li><li class="chapter-item "><a href="../getting-started/resources.html">External Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Arch Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/arch-network/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/arch-network/book/edit/main/src/program/accounts.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="account-guide"><a class="header" href="#account-guide">Account Guide</a></h1>
<blockquote>
<p><strong>Navigation</strong>: <a href="../SUMMARY.html#reference">Reference</a> ‚Üí <a href="./program.html">Program</a> ‚Üí Account Guide</p>
<p>For the core account structure and data types, see <a href="./account.html">Account Structure</a>.</p>
</blockquote>
<p>Accounts are the fundamental building blocks for state management and program interaction in Arch Network. They serve as containers for both program code and state data, bridging the gap between Bitcoin‚Äôs UTXO model and modern programmable state machines.</p>
<blockquote>
<p><strong>Note</strong>: For detailed documentation on core system functions used to interact with accounts (like <code>invoke</code>, <code>new_create_account_instruction</code>, <code>add_state_transition</code>, and <code>set_transaction_to_sign</code>), see <a href="./system-functions.html">System Functions</a>.</p>
</blockquote>
<pre class="mermaid">flowchart TD
    A[Account] --&gt; B[Program Account]
    A --&gt; C[Data Account]
    A --&gt; D[Native Account]
    B --&gt; E[Executable Code]
    C --&gt; F[Program State]
    C --&gt; G[UTXOs]
    D --&gt; H[System Operations]

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B fill:#f5f5f5,stroke:#666
    style C fill:#f5f5f5,stroke:#666
    style D fill:#f5f5f5,stroke:#666
</pre>
<h2 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h2>
<h3 id="account-fundamentals"><a class="header" href="#account-fundamentals">Account Fundamentals</a></h3>
<p>Every account in Arch Network is uniquely identified by a public key (pubkey) and contains four essential components:</p>
<pre><code class="language-rust ignore">pub struct Account {
    /// The program that owns this account
    pub owner: Pubkey,
    /// Number of lamports assigned to this account
    pub lamports: u64,
    /// Data held in this account
    pub data: Vec&lt;u8&gt;,
    /// Whether this account can process instructions
    pub executable: bool,
}</code></pre>
<h4 id="component-details"><a class="header" href="#component-details">Component Details:</a></h4>
<ol>
<li>
<p><strong>Owner (Pubkey)</strong></p>
<ul>
<li>Controls account modifications</li>
<li>Determines which program can modify data</li>
<li>Can be transferred to new programs</li>
<li>Required for all accounts</li>
</ul>
</li>
<li>
<p><strong>Lamports (u64)</strong></p>
<ul>
<li>Native token balance</li>
<li>Used for:
<ul>
<li>Transaction fees</li>
<li>Rent payments</li>
<li>State storage costs</li>
<li>Program execution fees</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Data (Vec<u8>)</strong></p>
<ul>
<li>Flexible byte array for state storage</li>
<li>Common uses:
<ul>
<li>Program code (if executable)</li>
<li>Program state</li>
<li>UTXO metadata</li>
<li>Configuration data</li>
</ul>
</li>
<li>Size determined at creation</li>
</ul>
</li>
<li>
<p><strong>Executable Flag (bool)</strong></p>
<ul>
<li>Determines if account contains program code</li>
<li>Immutable after deployment</li>
<li>Controls instruction processing capability</li>
</ul>
</li>
</ol>
<pre class="mermaid">flowchart LR
    A[Account Creation] --&gt; B[Initial State]
    B --&gt; C[Runtime Operations]
    C --&gt; D[State Updates]
    D --&gt; E[Account Closure]
    
    subgraph Lifecycle
        A -. Initialize .-&gt; B
        B -. Process Instructions .-&gt; C
        C -. Modify State .-&gt; D
        D -. Cleanup .-&gt; E
    end

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#9ff,stroke:#333,stroke-width:2px
    style Lifecycle fill:#f5f5f5,stroke:#666,stroke-width:1px
</pre>
<h2 id="account-types--use-cases"><a class="header" href="#account-types--use-cases">Account Types &amp; Use Cases</a></h2>
<h3 id="1-program-accounts"><a class="header" href="#1-program-accounts">1. Program Accounts</a></h3>
<p>Program accounts contain executable code and form the backbone of Arch Network‚Äôs programmable functionality.</p>
<pre><code class="language-rust ignore">// Example program account creation
let program_account = SystemInstruction::CreateAccount {
    lamports: rent.minimum_balance(program_data.len()),
    space: program_data.len() as u64,
    owner: bpf_loader::id(),  // BPF Loader owns program accounts
    executable: true,
    data: program_data,
};</code></pre>
<p>Key characteristics:</p>
<ul>
<li>Immutable after deployment</li>
<li>Owned by BPF loader</li>
<li>Contains verified program code</li>
<li>Processes instructions</li>
</ul>
<h3 id="2-data-accounts"><a class="header" href="#2-data-accounts">2. Data Accounts</a></h3>
<p>Data accounts store program state and user data. They‚Äôre highly flexible and can be structured to meet various needs.</p>
<pre><code class="language-rust ignore">// Example data structure for a game account
#[derive(BorshSerialize, BorshDeserialize)]
pub struct GameAccount {
    pub player: Pubkey,
    pub score: u64,
    pub level: u8,
    pub achievements: Vec&lt;Achievement&gt;,
    pub last_played: i64,
}

// Creating a data account
let game_account = SystemInstruction::CreateAccount {
    lamports: rent.minimum_balance(size_of::&lt;GameAccount&gt;()),
    space: size_of::&lt;GameAccount&gt;() as u64,
    owner: game_program::id(),
    executable: false,
    data: Vec::new(),  // Will be initialized by program
};</code></pre>
<p>Common use cases:</p>
<ul>
<li>Player profiles</li>
<li>Game state</li>
<li>DeFi positions</li>
<li>NFT metadata</li>
<li>Configuration settings</li>
</ul>
<h3 id="3-utxo-accounts"><a class="header" href="#3-utxo-accounts">3. UTXO Accounts</a></h3>
<p>Special data accounts that bridge Bitcoin UTXOs with Arch Network state.</p>
<pre><code class="language-rust ignore">#[derive(BorshSerialize, BorshDeserialize)]
pub struct UtxoAccount {
    pub meta: UtxoMeta,
    pub owner: Pubkey,
    pub delegate: Option&lt;Pubkey&gt;,
    pub state: UtxoState,
    pub created_at: i64,
    pub last_updated: i64,
    pub constraints: Vec&lt;UtxoConstraint&gt;,
}

// Example UTXO account creation
let utxo_account = SystemInstruction::CreateAccount {
    lamports: rent.minimum_balance(size_of::&lt;UtxoAccount&gt;()),
    space: size_of::&lt;UtxoAccount&gt;() as u64,
    owner: utxo_program::id(),
    executable: false,
    data: Vec::new(),
};</code></pre>
<h2 id="account-interactions"><a class="header" href="#account-interactions">Account Interactions</a></h2>
<p>Account interactions in Arch Network are facilitated through a set of core system functions. These functions handle everything from account creation to state transitions and are documented in detail in <a href="./system-functions.html">System Functions</a>. Below are common patterns for account interactions:</p>
<h3 id="1-creation-patterns"><a class="header" href="#1-creation-patterns">1. Creation Patterns</a></h3>
<pre><code class="language-rust ignore">// 1. Basic account creation
pub fn create_basic_account(
    payer: &amp;Keypair,
    space: u64,
    owner: &amp;Pubkey,
) -&gt; Result&lt;Keypair, Error&gt; {
    let account = Keypair::new();
    let rent = banks_client.get_rent().await?;
    let lamports = rent.minimum_balance(space as usize);
    
    let ix = system_instruction::create_account(
        &amp;payer.pubkey(),
        &amp;account.pubkey(),
        lamports,
        space,
        owner,
    );
    
    let tx = Transaction::new_signed_with_payer(
        &amp;[ix],
        Some(&amp;payer.pubkey()),
        &amp;[payer, &amp;account],
        recent_blockhash,
    );
    
    banks_client.process_transaction(tx).await?;
    Ok(account)
}

// 2. PDA (Program Derived Address) creation
pub fn create_pda_account(
    program_id: &amp;Pubkey,
    seeds: &amp;[&amp;[u8]],
    space: u64,
) -&gt; Result&lt;Pubkey, Error&gt; {
    let (pda, bump) = Pubkey::find_program_address(seeds, program_id);
    
    let ix = system_instruction::create_account(
        &amp;payer.pubkey(),
        &amp;pda,
        lamports,
        space,
        program_id,
    );
    
    // Include the bump seed for deterministic address
    let seeds_with_bump = &amp;[&amp;seeds[..], &amp;[&amp;[bump]]].concat();
    let signer_seeds = &amp;[&amp;seeds_with_bump[..]];
    
    invoke_signed(&amp;ix, &amp;[payer, pda], signer_seeds)?;
    Ok(pda)
}</code></pre>
<h3 id="2-state-management"><a class="header" href="#2-state-management">2. State Management</a></h3>
<pre><code class="language-rust ignore">// Example of managing account state
pub trait AccountState: Sized {
    fn try_from_slice(data: &amp;[u8]) -&gt; Result&lt;Self, Error&gt;;
    fn try_serialize(&amp;self) -&gt; Result&lt;Vec&lt;u8&gt;, Error&gt;;
    
    fn load(account: &amp;AccountInfo) -&gt; Result&lt;Self, Error&gt; {
        Self::try_from_slice(&amp;account.data.borrow())
    }
    
    fn save(&amp;self, account: &amp;AccountInfo) -&gt; Result&lt;(), Error&gt; {
        let data = self.try_serialize()?;
        let mut account_data = account.data.borrow_mut();
        account_data[..data.len()].copy_from_slice(&amp;data);
        Ok(())
    }
}

// Implementation example
impl AccountState for GameAccount {
    fn update_score(&amp;mut self, new_score: u64) -&gt; Result&lt;(), Error&gt; {
        self.score = new_score;
        self.last_played = Clock::get()?.unix_timestamp;
        Ok(())
    }
}</code></pre>
<h3 id="3-cross-program-invocation-cpi"><a class="header" href="#3-cross-program-invocation-cpi">3. Cross-Program Invocation (CPI)</a></h3>
<pre><code class="language-rust ignore">// Example of one program calling another
pub fn process_instruction(
    program_id: &amp;Pubkey,
    accounts: &amp;[AccountInfo],
    instruction_data: &amp;[u8],
) -&gt; ProgramResult {
    // Deserialize accounts
    let account_info_iter = &amp;mut accounts.iter();
    let source_info = next_account_info(account_info_iter)?;
    let dest_info = next_account_info(account_info_iter)?;
    let system_program = next_account_info(account_info_iter)?;
    
    // Create CPI context
    let cpi_accounts = Transfer {
        from: source_info.clone(),
        to: dest_info.clone(),
    };
    let cpi_program = system_program.clone();
    let cpi_ctx = CpiContext::new(cpi_program, cpi_accounts);
    
    // Perform cross-program invocation
    transfer(cpi_ctx, amount)?;
    
    Ok(())
}</code></pre>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="1-access-control"><a class="header" href="#1-access-control">1. Access Control</a></h3>
<pre><code class="language-rust ignore">fn verify_account_access(
    account: &amp;AccountInfo,
    expected_owner: &amp;Pubkey,
    writable: bool,
) -&gt; ProgramResult {
    // Check account ownership
    if account.owner != expected_owner {
        return Err(ProgramError::IncorrectProgramId);
    }
    
    // Verify write permission if needed
    if writable &amp;&amp; !account.is_writable {
        return Err(ProgramError::InvalidAccountData);
    }
    
    // Additional checks...
    Ok(())
}</code></pre>
<h3 id="2-data-validation"><a class="header" href="#2-data-validation">2. Data Validation</a></h3>
<pre><code class="language-rust ignore">fn validate_account_data&lt;T: AccountState&gt;(
    account: &amp;AccountInfo,
    validate_fn: impl Fn(&amp;T) -&gt; bool,
) -&gt; ProgramResult {
    // Load and validate account data
    let data = T::load(account)?;
    if !validate_fn(&amp;data) {
        return Err(ProgramError::InvalidAccountData);
    }
    Ok(())
}</code></pre>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-account-management"><a class="header" href="#1-account-management">1. Account Management</a></h3>
<ul>
<li>Always validate account ownership before modifications</li>
<li>Use PDAs for deterministic addresses</li>
<li>Implement proper error handling</li>
<li>Close unused accounts to reclaim rent</li>
</ul>
<h3 id="2-data-safety"><a class="header" href="#2-data-safety">2. Data Safety</a></h3>
<ul>
<li>Validate all input data</li>
<li>Use proper serialization</li>
<li>Handle account size limits</li>
<li>Implement atomic operations</li>
</ul>
<h3 id="3-performance"><a class="header" href="#3-performance">3. Performance</a></h3>
<ul>
<li>Minimize account creations</li>
<li>Batch operations when possible</li>
<li>Use appropriate data structures</li>
<li>Cache frequently accessed data</li>
</ul>
<h3 id="4-upgrades"><a class="header" href="#4-upgrades">4. Upgrades</a></h3>
<ul>
<li>Plan for version management</li>
<li>Implement migration strategies</li>
<li>Use flexible data structures</li>
<li>Document state changes</li>
</ul>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="1-account-initialization"><a class="header" href="#1-account-initialization">1. Account Initialization</a></h3>
<pre><code class="language-rust ignore">pub fn initialize_account&lt;T: AccountState&gt;(
    program_id: &amp;Pubkey,
    account: &amp;AccountInfo,
    initial_state: T,
) -&gt; ProgramResult {
    // Verify account is uninitialized
    if !account.data_is_empty() {
        return Err(ProgramError::AccountAlreadyInitialized);
    }
    
    // Set account owner
    account.set_owner(program_id)?;
    
    // Initialize state
    initial_state.save(account)?;
    
    Ok(())
}</code></pre>
<h3 id="2-account-updates"><a class="header" href="#2-account-updates">2. Account Updates</a></h3>
<pre><code class="language-rust ignore">pub fn update_account&lt;T: AccountState&gt;(
    account: &amp;AccountInfo,
    update_fn: impl FnOnce(&amp;mut T) -&gt; ProgramResult,
) -&gt; ProgramResult {
    // Load current state
    let mut state = T::load(account)?;
    
    // Apply update
    update_fn(&amp;mut state)?;
    
    // Save updated state
    state.save(account)?;
    
    Ok(())
}</code></pre>
<h3 id="3-account-closure"><a class="header" href="#3-account-closure">3. Account Closure</a></h3>
<pre><code class="language-rust ignore">pub fn close_account(
    account: &amp;AccountInfo,
    destination: &amp;AccountInfo,
) -&gt; ProgramResult {
    // Transfer lamports
    let dest_starting_lamports = destination.lamports();
    **destination.lamports.borrow_mut() = dest_starting_lamports
        .checked_add(account.lamports())
        .ok_or(ProgramError::Overflow)?;
    **account.lamports.borrow_mut() = 0;
    
    // Clear data
    account.data.borrow_mut().fill(0);
    
    Ok(())
}</code></pre>
<h2 id="related-topics"><a class="header" href="#related-topics">Related Topics</a></h2>
<ul>
<li><a href="./utxo.html">UTXOs</a> - How UTXOs integrate with accounts</li>
<li><a href="./program.html">Programs</a> - Programs that own and modify accounts</li>
<li><a href="./instructions-and-messages.html">Instructions</a> - How to interact with accounts</li>
</ul>
<!-- Internal -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../program/utxo.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../program/instructions-and-messages.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../program/utxo.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../program/instructions-and-messages.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/mermaid.min.js"></script>
        <script src="../theme/mermaid-init.js"></script>
        <script src="../theme/custom.js"></script>


    </div>
    </body>
</html>
