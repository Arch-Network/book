<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Program interaction - The Arch Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="Documentation for the Arch Network - A Bitcoin-native computation environment">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item affix "><li class="part-title">Getting Started</li><li class="chapter-item "><a href="../getting-started/quick-start.html">Quick Start Guide</a></li><li class="chapter-item "><a href="../getting-started/environment-setup.html">Environment Setup</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../getting-started/bitcoin-and-electrs-setup.html">Bitcoin and Electrs Setup</a></li><li class="chapter-item "><a href="../getting-started/setting-up-a-project.html">Setting up a Project</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../concepts/nodes.html">Nodes</a></li></ol></li></ol></li><li class="chapter-item "><a href="../getting-started/resources.html">Resources</a></li><li class="chapter-item affix "><li class="part-title">Core Concepts</li><li class="chapter-item "><a href="../concepts/architecture.html">Architecture Overview</a></li><li class="chapter-item "><a href="../concepts/network-architecture.html">Network Architecture</a></li><li class="chapter-item "><a href="../concepts/bitcoin-integration.html">Bitcoin Integration</a></li><li class="chapter-item "><a href="../concepts/nodes.html">Nodes</a></li><li class="chapter-item "><a href="../program/program.html">Programs</a></li><li class="chapter-item "><a href="../program/utxo.html">UTXOs</a></li><li class="chapter-item affix "><li class="part-title">Programs and beyond</li><li class="chapter-item expanded "><a href="../basics/basics.html">Basics</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../basics/building-deploying-interfacing.html">Building, deploying and interfacing</a></li><li class="chapter-item expanded "><a href="../basics/interaction.html" class="active">Program interaction</a></li></ol></li><li class="chapter-item "><a href="../guides/guides.html">Guides</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../guides/how-to-write-arch-program.html">How to write an Arch program</a></li><li class="chapter-item "><a href="../guides/how-to-write-oracle-program.html">How to write an oracle program</a></li><li class="chapter-item "><a href="../guides/how-to-create-a-fungible-token.html">How to create a fungible token</a></li><li class="chapter-item "><a href="../guides/how-to-build-runes-swap.html">How to build a Bitcoin Runes swap application</a></li><li class="chapter-item "><a href="../guides/how-to-configure-local-validator-bitcoin-testnet4.html">How to configure the local validator with Bitcoin Testnet4</a></li><li class="chapter-item "><a href="../guides/how-to-build-lending-protocol.html">How to Build a Bitcoin Lending Protocol</a></li></ol></li><li class="chapter-item "><li class="part-title">Reference</li><li class="chapter-item "><a href="../program/program.html">Program</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../program/account.html">Account Structure</a></li><li class="chapter-item "><a href="../program/accounts.html">Account Guide</a></li><li class="chapter-item "><a href="../program/system-functions.html">System Functions</a></li><li class="chapter-item "><a href="../program/entrypoint.html">Entrypoint</a></li><li class="chapter-item "><a href="../program/instructions-and-messages.html">Instructions and Messages</a></li><li class="chapter-item "><a href="../program/pubkey.html">Pubkey</a></li><li class="chapter-item "><a href="../program/syscall.html">Syscall</a></li><li class="chapter-item "><a href="../program/system-instruction.html">System Instruction</a></li><li class="chapter-item "><a href="../program/utxo.html">UTXO</a></li></ol></li><li class="chapter-item "><a href="../sdk/sdk.html">SDK</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../sdk/processed-transaction.html">Processed Transaction</a></li><li class="chapter-item "><a href="../sdk/runtime-transaction.html">Runtime Transaction</a></li><li class="chapter-item "><a href="../sdk/signature.html">Signature</a></li></ol></li><li class="chapter-item "><a href="../system-program/system-program.html">System Program</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../system-program/create-account.html">CreateAccount</a></li><li class="chapter-item "><a href="../system-program/write-bytes.html">WriteBytes</a></li><li class="chapter-item "><a href="../system-program/make-executable.html">MakeExecutable</a></li><li class="chapter-item "><a href="../system-program/assign-ownership.html">AssignOwnership</a></li></ol></li><li class="chapter-item "><a href="../rpc/rpc.html">RPC</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rpc/http-methods.html">HTTP Methods</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rpc/http-methods/send-transaction.html">sendTransaction</a></li><li class="chapter-item "><a href="../rpc/http-methods/send-transactions.html">sendTransactions</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-account-address.html">getAccountAddress</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-program-accounts.html">getProgramAccounts</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-block.html">getBlock</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-block-count.html">getBlockCount</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-block-hash.html">getBlockHash</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-current-state.html">getCurrentState</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-peers.html">getPeers</a></li><li class="chapter-item "><a href="../rpc/http-methods/get-processed-transaction.html">getProcessedTransaction</a></li><li class="chapter-item "><a href="../rpc/http-methods/read-account-info.html">readAccountInfo</a></li><li class="chapter-item "><a href="../rpc/http-methods/start-dkg.html">startDkg</a></li><li class="chapter-item "><a href="../rpc/http-methods/is-node-ready.html">isNodeReady</a></li><li class="chapter-item "><a href="../rpc/http-methods/reset-network.html">resetNetwork</a></li></ol></li><li class="chapter-item "><a href="../rpc/deprecated-methods.html">Deprecated Methods</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../rpc/deprecated-methods/get-account-info.html">getAccountInfo</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Arch Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/arch-network/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/arch-network/book/edit/main/src/basics/interaction.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="program-interaction"><a class="header" href="#program-interaction">Program interaction</a></h1>
<p>Table of Contents:</p>
<ul>
<li><a href="#description">Description</a></li>
<li><a href="#logic">Logic</a></li>
</ul>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>Continuing with our example program, a Graffiti Wall, we’ll explore an implementation example of how to communicate with a deployed <a href="../program/program.html">Program</a> by looking at the frontend code.</p>
<h2 id="logic"><a class="header" href="#logic">Logic</a></h2>
<pre><code class="language-typescript">const client = new RpcConnection((import.meta as any).env.VITE_RPC_URL || 'http://localhost:9002');
const PROGRAM_PUBKEY = (import.meta as any).env.VITE_PROGRAM_PUBKEY;
const WALL_ACCOUNT_PUBKEY = (import.meta as any).env.VITE_WALL_ACCOUNT_PUBKEY;
</code></pre>
<p>Here we initialize a new RPC connection and pass in the RPC URL that we wish to connect to; in this case, the URL is pulled from the environment variables or defaults to our locally running validator.</p>
<p>We then import the <a href="../program/pubkey.html">Pubkey</a>s of the Graffiti Wall <a href="../program/program.html">Program</a> as well as the Wall state Account. The Wall state Account stores the state of the Graffiti Wall and the Program’s <a href="../program/pubkey.html">Pubkey</a> serves as the owner of the Graffiti Wall.</p>
<pre><code class="language-typescript">class GraffitiMessage {
  constructor(
    public timestamp: number,
    public name: string,
    public message: string
  ) {}

  static schema = new Map([
    [
      GraffitiMessage,
      {
        kind: 'struct',
        fields: [
          ['timestamp', 'i64'],
          ['name', ['u8', 64]],
          ['message', ['u8', 64]]
        ]
      }
    ]
  ]);
}

// Define the schema for the wall containing messages
class GraffitiWall {
  constructor(public messages: GraffitiMessage[]) {}

  static schema = new Map([
    [
      GraffitiWall,
      {
        kind: 'struct',
        fields: [
          ['messages', [GraffitiMessage]]
        ]
      }
    ]
  ]);
}
</code></pre>
<p>We then define the schemas for handling the Wall’s message data- these schemas mirror the data structure that are found within the Graffiti Wall program which ensures data uniformity between the application frontend and program backend during serialization/deserialization.</p>
<pre><code class="language-rust ignore">#[derive(Debug, Clone, BorshSerialize, BorshDeserialize)]
pub struct GraffitiMessage {
    pub timestamp: i64,
    pub name: [u8; 64],
    pub message: [u8; 64],
}</code></pre>
<p>Above is the data structure as defined in our program source code.</p>
<pre><code class="language-typescript">  const accountPubkey = PubkeyUtil.fromHex(WALL_ACCOUNT_PUBKEY);

  const schema = {
    struct: {
      messages: {
        seq: {
          struct: {
            timestamp: 'i64',
            name: { array: { type: 'u8', len: 64 } },
            message: { array: { type: 'u8', len: 64 } }
          }
        }
      }
    }
  };
</code></pre>
<p>Moving along, we set the <code>accountPubkey</code> variable with our previously imported Wall account <a href="../program/pubkey.html">Pubkey</a> converted from hexidecimal and then set a new schema for to handle the Graffiti Wall message data.</p>
<pre><code class="language-typescript">const checkProgramDeployed = useCallback(async () =&gt; {
  try {
    const pubkeyBytes = PubkeyUtil.fromHex(PROGRAM_PUBKEY);
    const accountInfo = await client.readAccountInfo(pubkeyBytes);
    if (accountInfo) {
      setIsProgramDeployed(true);
      setError(null);
    }
  } catch (error) {
    console.error('Error checking program:', error);
    setError('The Arch Graffiti program has not been deployed to the network yet. Please run `arch-cli deploy` to deploy your program.');
  }
}, []);
</code></pre>
<p>We then submit our first request to the Arch RPC service: <code>readAccountInfo</code>.</p>
<p>We pass the <code>pubkeyBytes</code>- which represents the <code>program_id</code>, indicating the unique resource location of the <a href="../program/program.html">Program</a> within the Arch Network- as the argument to <code>readAccountInfo</code> in order to obtain the <a href="../program/account.html">AccountInfo</a>.</p>
<p>If we are able to read the <code>accountInfo</code> successfully, then we can be sure the program was deployed.</p>
<pre><code class="language-typescript">  const checkAccountCreated = useCallback(async () =&gt; {
    try {
      const pubkeyBytes = PubkeyUtil.fromHex(WALL_ACCOUNT_PUBKEY);
      const accountInfo = await client.readAccountInfo(pubkeyBytes);
      if (accountInfo) {
        setIsAccountCreated(true);
        setError(null);
      }
    } catch (error) {
      console.error('Error checking account:', error);
      setIsAccountCreated(false);
      setError('The wall account has not been created yet. Please run the account creation command.');
    }
  }, []);
</code></pre>
<p>Similarly, we perform the same check against the Wall account, ensuring that the Graffiti wall has an account provisioned to manage the program’s state. Without this state account the program would not have any data to work with; as a reminder, every Arch <a href="../program/program.html">Program</a> is stateless.</p>
<pre><code class="language-typescript">const fetchWallData = useCallback(async () =&gt; {
    try {
        const userAccount = await client.readAccountInfo(accountPubkey);
        if (!userAccount) {
            setError('Account not found.');
            return;
        }
        const wallData = userAccount.data;
        
        console.log(`Wall data: ${wallData}`);
...
</code></pre>
<p>We then begin to retrieve the Graffiti Wall data from the Wall account.</p>
<p>We make an RPC call to read in the account info just as we did in the previous step, only this time we access the data stored within the <a href="../program/account.html">AccountInfo</a>. As of now, this data is not yet parsed, so it comes back as bytes which will need to be handled.</p>
<pre><code class="language-typescript">        // If data is empty or invalid length, just set empty messages without error
        if (!wallData || wallData.length &lt; 4) {
            setWallData([]);
            setError(null); // Clear any existing errors
            return;
        }
</code></pre>
<p>We perform a check against the length of this bytedata to ensure that it is not empty, meaning there is at least some data stored within the Wall account.</p>
<pre><code class="language-typescript">        // Deserialize the wall data using borsh
        // Read data directly from the buffer
        const messages = [];
        let offset = 0;

        // First 4 bytes are the array length
        const messageCount = new DataView(wallData.buffer).getUint32(offset, true);
        offset += 4;

        for (let i = 0; i &lt; messageCount; i++) {
            // Read timestamp (8 bytes)
            const timestamp = new DataView(wallData.buffer).getBigInt64(offset, true);
            offset += 8;

            // Read name (64 bytes)
            const nameBytes = wallData.slice(offset, offset + 64);
            const name = new TextDecoder().decode(nameBytes.filter(x =&gt; x !== 0));
            offset += 64;

            // Read message (64 bytes)
            const messageBytes = wallData.slice(offset, offset + 64);
            const message = new TextDecoder().decode(messageBytes.filter(x =&gt; x !== 0));
            offset += 64;

            messages.push(new GraffitiMessage(
                Number(timestamp),
                name,
                message
            ));
        }

        messages.sort((a, b) =&gt; b.timestamp - a.timestamp);

        setWallData(messages);
    } catch (error) {
        console.error('Error fetching wall data:', error);
        setError(`Failed to fetch wall data: ${error instanceof Error ? error.message : String(error)}`);
    }
    ...
</code></pre>
<p>We now need to deserialize the bytedata into a structure that is more manageable, in this case, we’ll make use of the <code>GraffitiMessage</code> schema we set earlier.</p>
<pre><code class="language-typescript">  const handleAddToWall = async () =&gt; {
    if (!message.trim() || !name.trim() || !isAccountCreated || !wallet.isConnected) {
      setError("Name and message are required, account must be created, and wallet must be connected.");
      return;
    }
</code></pre>
<p>We’ll again skip over some React state management.</p>
<p><code>handleAddToWall</code> contains the lion’s share of the logic for serializing data and submitting this data to the <a href="../program/program.html">Program</a>.</p>
<pre><code class="language-typescript">  const serializeGraffitiData = (name: string, message: string): number[] =&gt; {
    // Create fixed-size arrays
    const nameArray = new Uint8Array(64).fill(0);
    const messageArray = new Uint8Array(64).fill(0);
    
    // Convert strings to bytes
    const nameBytes = new TextEncoder().encode(name);
    const messageBytes = new TextEncoder().encode(message);
    
    // Copy bytes into fixed-size arrays (will truncate if too long)
    nameArray.set(nameBytes.slice(0, 64));
    messageArray.set(messageBytes.slice(0, 64));
    
    // Create the params object matching the Rust struct
    const params = {
        name: Array.from(nameArray),
        message: Array.from(messageArray)
    };
    
    // Define the schema for borsh serialization
    const schema = {
        struct: {
            name: { array: { type: 'u8', len: 64 } },
            message: { array: { type: 'u8', len: 64 } }
        }
    };
    
    return Array.from(borsh.serialize(schema, params));
    ...
</code></pre>
<p>In this anonymous function we pass in our dapp data, <code>name</code> and <code>message</code> in order to prepare it for submission to the <a href="../program/program.html">Program</a>.</p>
<p>We create two new <code>Uint8</code> byte arrays and initialize their appropriate lengths with placeholder zeros, eventually copying the encoded <code>name</code> and <code>message</code> data into into fixed-size arrays and storing them within the <code>params</code> object.</p>
<p>We define the schema for the data and serialize the scheme alongside the <code>params</code> object which we will use within the following <code>try</code> block.</p>
<pre><code class="language-typescript">    try {
      const data = serializeGraffitiData(name, message);
    
      const instruction: Instruction = {
        program_id: PubkeyUtil.fromHex(PROGRAM_PUBKEY),
        accounts: [
          { 
            pubkey: PubkeyUtil.fromHex(wallet.publicKey!), 
            is_signer: true, 
            is_writable: false 
          },
          { 
            pubkey: accountPubkey, 
            is_signer: false, 
            is_writable: true 
          },
        ],
        data: new Uint8Array(data),
      };
...
</code></pre>
<p>Stepping into our <code>try</code> block, we serialize our post data, in this case including the name of the author as well as the message they wish to post.</p>
<p>We construct an [Instruction] object, containing our <code>program_id</code>, serialized data, as well as the accounts involved, in this case, the signing <a href="../program/pubkey.html">Pubkey</a> of our user’s wallet as well as the <code>accountPubkey</code>, the <a href="../program/pubkey.html">Pubkey</a> of the Wall state account.</p>
<pre><code class="language-typescript">   const messageObj : Message = {
        signers: [PubkeyUtil.fromHex(wallet.publicKey!)],
        instructions: [instruction],
      };
</code></pre>
<p>We then construct our [Message] object to hold the needed signers (our user) as well as the previously formed [Instruction].</p>
<pre><code class="language-typescript">const messageBytes = MessageUtil.serialize(messageObj);
...
const signature = await wallet.signMessage(Buffer.from(MessageUtil.hash(messageObj)).toString('hex'));
</code></pre>
<p>We then serialize our [Message] and then craft our [Signature].</p>
<pre><code class="language-typescript">const signatureBytes = new Uint8Array(Buffer.from(signature, 'base64')).slice(2);
console.log(`Signature bytes: ${signatureBytes}`);

const result = await client.sendTransaction({
  version: 0,
  signatures: [signatureBytes],
  message: messageObj,
});
</code></pre>
<p>We then store our [Signature] within a new <code>Uint8</code> array and create a slice from it in order to segregate the last 64-bytes of the base64 decoded [Signature].</p>
<pre><code class="language-typescript">const result = await client.sendTransaction({
  version: 0,
  signatures: [signatureBytes],
  message: messageObj,
});
</code></pre>
<p>We then craft our [Transaction] object within the RPC call to <code>sendTransaction</code>, passing in our sliced [Signature] and serialized [Message], along with the correct [Transaction] version (<code>0</code>), successfully submitting our state change to the Arch Network for processing.</p>
<p>🎨</p>
<p>This concludes the logic walkthrough of the <a href="../program/program.html">Program</a> interaction component of our [GraffitiWall].</p>
<!-- Internal -->
<!-- External -->

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../basics/building-deploying-interfacing.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../guides/guides.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../basics/building-deploying-interfacing.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../guides/guides.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>



        <script>
            window.playground_line_numbers = true;
        </script>

        <script>
            window.playground_copyable = true;
        </script>

        <script src="../ace.js"></script>
        <script src="../editor.js"></script>
        <script src="../mode-rust.js"></script>
        <script src="../theme-dawn.js"></script>
        <script src="../theme-tomorrow_night.js"></script>

        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/mermaid.min.js"></script>
        <script src="../theme/mermaid-init.js"></script>
        <script src="../theme/custom.js"></script>


    </div>
    </body>
</html>
